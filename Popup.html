<!DOCTYPE html>
<html>

<head>
    <base target="_top">
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f7f9;
            color: #3c4043;
        }

        .header {
            background: #fff;
            padding: 15px 20px;
            border-bottom: 1px solid #dadce0;
            position: sticky;
            top: 0;
        }

        h2 {
            margin: 0;
            font-size: 18px;
            color: #1a73e8;
        }

        .container {
            padding: 15px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        /* Estilo dos 10 Blocos (Workspaces) */
        .workspace-card {
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 8px;
            box-shadow: 0 1px 2px rgba(60, 64, 67, 0.1);
            overflow: hidden;
        }

        .workspace-header {
            background: #f8f9fa;
            padding: 8px 12px;
            font-weight: bold;
            font-size: 13px;
            border-bottom: 1px solid #dadce0;
            color: #5f6368;
            text-transform: uppercase;
        }

        .account-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border-bottom: 1px solid #f1f3f4;
            cursor: pointer;
            font-size: 14px;
        }

        .account-item:last-child {
            border-bottom: none;
        }

        .account-item:hover {
            background-color: #f1f8fe;
        }

        input[type="checkbox"] {
            margin-right: 12px;
            transform: scale(1.2);
            accent-color: #1a73e8;
        }

        .footer {
            position: sticky;
            bottom: 0;
            background: #fff;
            padding: 15px;
            border-top: 1px solid #dadce0;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        button {
            padding: 8px 20px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-weight: 500;
        }

        .btn-save {
            background: #1a73e8;
            color: white;
        }

        .btn-save:hover {
            background: #1557b0;
        }

        .btn-cancel {
            background: #fff;
            border: 1px solid #dadce0;
            color: #5f6368;
        }
    </style>
</head>

<body>

    <div class="header">
        <h2>Seletor Inteligente MyCreator</h2>
    </div>

    <div class="container" id="main-content">
        <p style="text-align:center;">Carregando seus Workspaces...</p>
    </div>

    <div class="footer">
        <button class="btn-cancel" onclick="google.script.host.close()">Cancelar</button>
        <button class="btn-save" onclick="salvar()">Salvar na Planilha</button>
    </div>

    <script>
        // Carrega dados ao abrir
        google.script.run.withSuccessHandler(desenharInterface).getDadosParaPopup();

        function desenharInterface(dados) {
            const container = document.getElementById('main-content');
            container.innerHTML = ''; // Limpa o carregando

            const estrutura = dados.estrutura;
            const selecionados = dados.selecionados;

            // Itera sobre cada Workspace para criar os blocos
            for (const workspace in estrutura) {
                const infoWorkspace = estrutura[workspace]; // Pega o objeto {infoWorkspace.perfis}
                const card = document.createElement('div');
                card.className = 'workspace-card';

                const header = document.createElement('div');
                header.className = 'workspace-header';
                header.textContent = infoWorkspace.nome; // AQUI: Usa o nome da coluna A
                card.appendChild(header);

                const list = document.createElement('div');

                infoWorkspace.perfis.forEach(conta => {
                    const label = document.createElement('label');
                    label.className = 'account-item';

                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.value = conta;
                    if (selecionados.includes(conta)) checkbox.checked = true;

                    // Limpa o nome para nÃ£o repetir o Workspace no texto
                    const nomeExibicao = conta.split(' - ')[1] || conta;

                    label.appendChild(checkbox);
                    label.appendChild(document.createTextNode(nomeExibicao));
                    list.appendChild(label);
                });

                card.appendChild(list);
                container.appendChild(card);
            }
        }

        function salvar() {
            const checks = document.querySelectorAll('input[type="checkbox"]:checked');
            const selecionados = Array.from(checks).map(c => c.value);

            google.script.run.withSuccessHandler(() => {
                google.script.host.close();
            }).salvarSelecaoNaCelula(selecionados);
        }
    </script>
</body>

</html>